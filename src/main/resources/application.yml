spring:
  application:
    name: data-distributor
  datasource:
    url: ${DB_URL:jdbc:sqlserver://localhost:1433;databaseName=apa;encrypt=false;trustServerCertificate=true}
    username: ${DB_USERNAME:sa}
    password: ${DB_PASSWORD:P@ssw0rd}
    driver-class-name: com.microsoft.sqlserver.jdbc.SQLServerDriver
  jpa:
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        dialect: org.hibernate.dialect.SQLServerDialect

data-distributor:
  external-api:
    base-url: ${iagPath:http://localhost:8081}
    write-signal-path: ${cehPath:/create-signal/write-signal}
    publisher: ${DATA_DISTRIBUTOR_EXTERNAL_API_PUBLISHER:UABS}
    publisher-id: ${DATA_DISTRIBUTOR_EXTERNAL_API_PUBLISHER_ID:0bfe5670-457d-4872-a1f1-efe4db39f099}
    request-timeout-seconds: ${DATA_DISTRIBUTOR_EXTERNAL_API_REQUEST_TIMEOUT_SECONDS:15}
    use-blocking-client: ${DATA_DISTRIBUTOR_EXTERNAL_API_USE_BLOCKING_CLIENT:false}
    retry:
      attempts: ${DATA_DISTRIBUTOR_EXTERNAL_API_RETRY_ATTEMPTS:3}
      backoff-seconds: ${DATA_DISTRIBUTOR_EXTERNAL_API_RETRY_BACKOFF_SECONDS:5}
      max-backoff-seconds: ${DATA_DISTRIBUTOR_EXTERNAL_API_RETRY_MAX_BACKOFF_SECONDS:15}
  processing:
    batch-size: ${DATA_DISTRIBUTOR_PROCESSING_BATCH_SIZE:300}
    page-size: ${DATA_DISTRIBUTOR_PROCESSING_PAGE_SIZE:1000}
    rate-limit: ${DATA_DISTRIBUTOR_PROCESSING_RATE_LIMIT:20}
    min-unauthorized-debit-balance: ${DATA_DISTRIBUTOR_PROCESSING_MIN_UNAUTHORIZED_DEBIT_BALANCE:250}
    book-date-lookback-days: ${DATA_DISTRIBUTOR_PROCESSING_BOOK_DATE_LOOKBACK_DAYS:5}
  audit:
    consumer-id: ${DATA_DISTRIBUTOR_AUDIT_CONSUMER_ID:1}
  http:
    connect-timeout-ms: ${DATA_DISTRIBUTOR_HTTP_CONNECT_TIMEOUT_MS:10000}
    response-timeout-seconds: ${DATA_DISTRIBUTOR_HTTP_RESPONSE_TIMEOUT_SECONDS:10}
    read-timeout-seconds: ${DATA_DISTRIBUTOR_HTTP_READ_TIMEOUT_SECONDS:10}
    write-timeout-seconds: ${DATA_DISTRIBUTOR_HTTP_WRITE_TIMEOUT_SECONDS:10}
  storage:
    enabled: ${DATA_DISTRIBUTOR_STORAGE_ENABLED:false}
    container: ${DATA_DISTRIBUTOR_STORAGE_CONTAINER:reports}
    folder: ${DATA_DISTRIBUTOR_STORAGE_FOLDER:ceh}
    dial-folder: ${DATA_DISTRIBUTOR_STORAGE_DIAL_FOLDER:dial}
    dial-file-prefix: ${DATA_DISTRIBUTOR_STORAGE_DIAL_FILE_PREFIX:dial-signal-data}
    dial-scheduler-enabled: ${DATA_DISTRIBUTOR_STORAGE_DIAL_SCHEDULER_ENABLED:true}
    storage-url: ${DATA_DISTRIBUTOR_STORAGE_URL:}
    managed-identity-client-id: ${DATA_DISTRIBUTOR_STORAGE_MANAGED_IDENTITY_CLIENT_ID:}
  scheduler:
    enable2am: ${DATA_DISTRIBUTOR_SCHEDULER_ENABLE_2AM:true}
    enableMon10: ${DATA_DISTRIBUTOR_SCHEDULER_ENABLE_MON_10:true}
    enableMon12: ${DATA_DISTRIBUTOR_SCHEDULER_ENABLE_MON_12:true}
    enableRetry: ${DATA_DISTRIBUTOR_SCHEDULER_ENABLE_RETRY:true}
    signal2amCron: ${DATA_DISTRIBUTOR_SCHEDULER_SIGNAL_2AM_CRON:0 0 2 * * *}
    signalMon10Cron: ${DATA_DISTRIBUTOR_SCHEDULER_SIGNAL_MON_10_CRON:0 0 10 * * MON}
    signalMon12Cron: ${DATA_DISTRIBUTOR_SCHEDULER_SIGNAL_MON_12_CRON:0 0 12 * * MON}
    retryCron: ${DATA_DISTRIBUTOR_SCHEDULER_RETRY_CRON:0 0 13-23 * * TUE,WED,THU,FRI,SAT,SUN}
  async:
    core-pool-size: ${DATA_DISTRIBUTOR_ASYNC_CORE_POOL_SIZE:20}
    max-pool-size: ${DATA_DISTRIBUTOR_ASYNC_MAX_POOL_SIZE:50}
    queue-capacity: ${DATA_DISTRIBUTOR_ASYNC_QUEUE_CAPACITY:10000}
    thread-name-prefix: ${DATA_DISTRIBUTOR_ASYNC_THREAD_NAME_PREFIX:DataDistributor-}
azure:
  keyvault:
    enabled: ${AZURE_KEYVAULT_ENABLED:false}
    vault-url: ${AZURE_KEYVAULT_VAULT_URL:}
    certificate-name: ${AZURE_KEYVAULT_CERTIFICATE_NAME:}
    certificate-password: ${AZURE_KEYVAULT_CERTIFICATE_PASSWORD:}
    client-id: ${AZURE_KEYVAULT_CLIENT_ID:}
logging:
  level:
    com.datadistributor.outadapter.web: DEBUG
resilience4j:
  circuitbreaker:
    instances:
      signalEventApi:
        sliding-window-type: COUNT_BASED
        sliding-window-size: 100
        minimum-number-of-calls: 200
        failure-rate-threshold: 100
        wait-duration-in-open-state: 2s
        permitted-number-of-calls-in-half-open-state: 20
        automatic-transition-from-open-to-half-open-enabled: true
